/*
	Author: Bloodwyn http://steamcommunity.com/profiles/76561198055205907/
	This is heavy wip. Beware of ugly code, strange math and cruel variable names.
*/

BW_customMapMarker = createMarkerLocal ["customMap", [worldSize/2,worldSize/2]];

Power = .6;
staticPower = 0; //50
sidePower = 12000;
SideForce = .12;
sleepTime = 0.1;
waterrate = 100;

aimmode = 1;

BW_ActionData = [];
BW_activeAction = [];
BW_activeExternAction = [];

BW_cShip = objNull;

BW_actionDis = 3;
BW_actionDis2 = 0.1;

BW_actionKey = false;
BW_dragging = false;
BW_blockAction = false;
BW_sail_inRopeMode = false;
BW_sail_ropeMode = [];

BW_OnEachFrameScripts = [];
addMissionEventHandler ["EachFrame", {BW_OnEachFrameScripts apply {call (_x # 1)};}];

["action",BW_sail_fnc_actionHandler] call BW_sail_fnc_stackOnEachFrame;

BW_waitUntilTimeData = [];
["waitUntilTime",BW_sail_fnc_waitUntilTime] call BW_sail_fnc_stackOnEachFrame;

0 spawn{
	waitUntil {!isNull (findDisplay 46)};
	(findDisplay 46) displayAddEventHandler ["keydown",BW_sail_fnc_keyDown];
	(findDisplay 46) displayAddEventHandler ["keyup",BW_sail_fnc_keyUp];

	if !(BW_customMapMarker in allMapMarkers)then{
		BW_customMapMarker = createMarkerLocal ["customMap", [worldSize/2,worldSize/2]];
	};

	private _customMap = getText(configfile >> "CfgWorlds" >> worldName >> "1715_customMap");
	//_customMap = "1715_custom_map_cat_cay";
	if !(_customMap isEqualTo "")then{
		BW_customMapMarker setMarkerTypeLocal _customMap;
		BW_customMapMarker setMarkerColorLocal "ColorWhite";

		["customMap",{
			private _control = (findDisplay 12) displayCtrl 51;
			if(isNull _control)exitWith{};
			private _zoom = ctrlMapScale _control;
			private _size = (1/_zoom) * 20;
			BW_customMapMarker setMarkerSizeLocal [_size,_size];
		}] call BW_sail_fnc_stackOnEachFrame;
	};

	private _pos = worldSize/10;
	private _m = createMarkerLocal ["windIndicator", [_pos,_pos]];
	_m setMarkerTypeLocal "BW_windIndicator";
	_m setMarkerSizeLocal [3, 3];
	_m setMarkerColorLocal "ColorWhite";

	["windIndicator",{
		private _ppos = getpos player;
		_ppos set [2,0];
		private _pos = _ppos vectoradd (wind vectorMultiply -10000);
		drawIcon3D ["\1715_data\actionicons\wind_ca.paa", [1,1,1,0.2],asltoagl _pos, 2, 2, 0, "", .05,.05, "TahomaB", "right", true];
		"windIndicator" setMarkerDirLocal windDir;
	}] call BW_sail_fnc_stackOnEachFrame;


	player addEventHandler ["FiredMan", {
	params ["_unit", "_weapon", "_muzzle", "_mode", "_ammo", "_magazine", "_projectile", "_vehicle"];
	if(!isnull BW_cship && _muzzle isEqualTo "1715_grapplinghook_Muzzle")then{
		private _hook = "1715_objects_grappling_hook_F" createVehicle [0,0,0];
		private _pos = getposasl _projectile;
		private _vel = (velocity _projectile) vectoradd (velocity BW_cship);
		deleteVehicle _projectile;
		_hook setposasl (_pos);
		_hook setVelocity _vel;
		_hook addTorque [150,0,0];
		private _posM = BW_cship worldToModel (position player);
		private _con = getArray(configfile >> "cfgvehicles">> typeof BW_cship >> "RopeAttach");
		if(_con isEqualTo [])then{
			_con = [0,BW_cship worldToModel (position player vectoradd (vectordir player))];
		}else{
			_con = _con apply {
				_pos = (BW_cship selectionPosition _x);
				[_pos distance _posM,_x];
			};
			_con sort true;
		};
		private _r = ropeCreate [BW_cship,_con#0#1,_hook,"rope_attach",30];
		_hook setVariable ["rope",_r];
		_hook setVariable ["ropeStart",_con#0#1];
		_hook addEventHandler ["EpeContact",{
			params ["_hook", "_obj2", "", "", "_force"];
			_hook removeAllEventHandlers "EpeContact";
			//hint str _this;
			private _r = _hook getVariable ["rope",objNull];
			if(isNull _r)exitWith{};
			private _pos1 = (ropeEndPosition _r)#0;
			ropeDestroy _r;
			deleteVehicle _r;
			if(_obj2 isKindOf "ship" && _obj2 != BW_cship)then{
				_hook attachTo [_obj2];
				private _pos2 = position _hook;

				//hint format ["aa%1\n%2",BW_cship worldToModel _pos1,_pos1];
				//_r = ropeCreate[BW_cship, BW_cship worldToModel _pos1,_obj2,_obj2 worldToModel _pos2,2*(_pos2 distance _pos1)];

				private _r = ropeCreate[_obj2,_obj2 worldToModel _pos2,BW_cship, BW_cship worldToModel _pos1,30];

				private _otherRopes = BW_cship getVariable ["ropes",[]];
				_otherRopes pushBack [_hook getVariable ["ropeStart",""],_r,_obj2,""];
				BW_cship setVariable ["ropes",_otherRopes];

				//[_obj2, _obj2 worldToModel (position _hook)] ropeAttachTo _r;
			}else{
				[_r,_hook] spawn{sleep 5; ropeDestroy (_this#0); deleteVehicle (_this#1);};
			};
		}];
		[_r,_obj] spawn{sleep 8; ropeDestroy (_this#0); deleteVehicle (_this#1);};
	};
}];
};


0 spawn{
	waitUntil {!isNil "BW_WMO_exit" && !isNil "BW_WMO_exit"};
	if(!isNil "BW_anker" && {!isNull BW_anker})then{
		BW_anker call BW_sail_fnc_enterShip;
	};
	BW_WMO_enter pushBack {
		_this call BW_sail_fnc_enterShip;
	};
	BW_WMO_exit pushback {BW_cShip = objNull;};
};



tri_sail_traverse = [
[ -15, -10,  -7,  -5,  -3,  -2,  -2,  -2,   0,   0,   8,  22,  40,  60,  70,  85,  90,  88,  85,  80,  76,  73,  70,  65,  57,  48,  40,  37,  33,  30,  28,  27,  25,  23,  20,  18,  10,   5,   0,   0,   0,   0,   0,   0,   0,   0,  -2,  -2,  -3,  -5,  -7,  -9, -11, -13, -15, -17, -18, -18, -18, -17, -17, -16, -16, -15],
[ -14,  -9,  -6,  -4,  -2,  -2,  -2,  -2,   0,   0,  15,  35,  45,  65,  75,  87,  86,  85,  84,  79,  75,  72,  69,  64,  55,  47,  39,  36,  32,  29,  27,  26,  24,  22,  15,  10,   5,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  -2,  -2,  -3,  -5,  -7,  -9, -11, -13, -15, -17, -17, -16, -15, -16, -16, -15, -15],
[ -13,  -8,  -5,  -3,  -2,  -2,  -2,  -2,  -2,  10,  25,  40,  50,  72,  80,  88,  84,  82,  81,  78,  74,  71,  68,  63,  54,  46,  38,  35,  31,  28,  26,  22,  23,  15,  10,   5,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  -2,  -2,  -3,  -5,  -7,  -9, -11, -13, -16, -15, -15, -14, -14, -14, -14, -13],
[ -11,  -7,  -4,  -2,  -2,  -2,  -2,  -2,   5,  20,  38,  48,  65,  75,  82,  80,  75,  69,  67,  65,  63,  62,  59,  55,  50,  44,  37,  34,  30,  29,  25,  21,  21,  13,   7,   3,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  -2,  -2,  -3,  -5,  -7,  -9, -11, -14, -14, -14, -13, -13, -13, -12, -12],
[  -9,  -6,  -2,  -2,  -2,  -2,  -2,  -2,  10,  25,  45,  58,  68,  77,  84,  70,  60,  58,  56,  55,  53,  51,  49,  46,  43,  41,  36,  33,  29,  28,  26,  20,  19,  10,   5,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,  -2,  -2,  -3,  -5,  -7,  -9, -13, -11, -12, -12, -13, -11, -12, -11],
[  -8,  -6,  -2,  -2,  -2,  -2,  -2,   3,  22,  40,  53,  60,  70,  80,  70,  60,  50,  49,  48,  48,  47,  45,  43,  41,  40,  38,  35,  34,  28,  27,  25,  19,  17,   9,   4,   0,   0,   0,   0,   0,   1,   1,   1,   0,   0,   0,   0,   0,   0,   0,   0,  -2,  -2,  -3,  -5,  -7,  -8,  -9,  -7,  -8, -12, -11, -10,  -9],
[  -7,  -5,  -2,  -2,  -2,  -2,  -2,   4,  25,  50,  55,  65,  75,  78,  66,  55,  45,  44,  43,  42,  41,  40,  39,  38,  38,  37,  34,  33,  27,  26,  24,  18,  15,   8,   3,   0,   0,   0,   0,   1,   2,   2,   2,   2,   3,   1,   1,   0,   0,   0,   0,   0,  -2,  -2,  -3,  -5,  -9,  -7,  -6,  -7,  -9, -10,  -9,  -8],
[  -6,  -5,  -2,  -2,  -2,  -2,  -2,   5,  50,  58,  65,  70,  74,  77,  60,  40,  35,  30,  31,  31,  32,  32,  33,  34,  34,  35,  32,  31,  26,  25,  23,  17,  13,   7,   5,   0,   0,   0,   1,   2,   3,   4,   4,   5,   6,   6,   7,   7,   5,   0,   0,   0,   0,  -2,  -2,  -3,  -6,  -5,  -4,  -6,  -8,  -9,  -7,  -7],
[  -5,  -5,  -3,  -2,  -2,  -2,  -2,   6,  52,  55,  62,  67,  73,  75,  55,  45,  25,  26,  27,  28,  29,  30,  30,  31,  31,  32,  30,  29,  25,  24,  22,  16,  12,  10,   7,   0,   0,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  10,   6,   3,   2,   1,   0,  -2,  -2,  -2,  -2,  -2,  -3,  -6,  -6,  -6,  -5],
[  -5,  -4,  -3,  -2,  -2,  -2,  -2,   7,  50,  53,  60,  66,  65,  60,  50,  30,  20,  21,  22,  23,  24,  25,  27,  28,  29,  31,  29,  28,  24,  21,  20,  15,  11,  14,  10,   5,   0,   5,   6,   7,   8,   9,  10,  12,  11,  10,   9,   7,   6,  10,   5,   3,   2,   1,   0,   0,  -2,  -2,  -2,  -2,  -2,  -2,  -4,  -5],
[  -5,  -4,  -3,  -2,  -2,  -2,  -2,   8,  45,  50,  55,  60,  55,  40,  30,  25,  15,  17,  19,  20,  22,  23,  24,  25,  27,  30,  28,  25,  22,  20,  18,  15,  10,  15,  18,  20,  22,  25,  28,  30,  27,  25,  24,  21,  22,  20,  19,  17,  15,  25,  30,  40,  55,  60,  55,  50,  45,   8,  -2,  -2,  -2,  -2,  -3,  -4],
[  -5,  -5,  -4,  -2,  -2,  -2,  -2,  -2,  -2,   0,   0,   1,   2,   3,   5,  10,   6,   7,   9,  10,  11,  12,  10,   9,   8,   7,   6,   5,   0,   5,  10,  14,  11,  15,  20,  21,  24,  28,  29,  31,  29,  28,  27,  25,  24,  23,  22,  21,  20,  30,  50,  60,  65,  66,  60,  53,  50,   7,  -2,  -2,  -2,  -2,  -3,  -4],
[  -5,  -5,  -6,  -6,  -6,  -3,  -2,  -2,  -2,  -2,  -2,   0,   1,   2,   3,   6,  10,  14,  13,  12,  11,  10,   9,   8,   7,   6,   5,   4,   0,   0,   7,  10,  12,  16,  22,  24,  25,  29,  30,  32,  31,  31,  30,  30,  29,  28,  27,  26,  25,  45,  55,  75,  73,  67,  62,  55,  52,   6,  -2,  -2,  -2,  -2,  -3,  -5],
[  -6,  -7,  -7,  -9,  -8,  -6,  -4,  -5,  -6,  -3,  -2,  -2,   0,   0,   0,   0,   5,   7,   7,   6,   6,   5,   4,   4,   3,   2,   1,   0,   0,   0,   5,   7,  13,  17,  23,  25,  26,  31,  32,  35,  34,  34,  33,  32,  32,  31,  31,  30,  35,  40,  60,  77,  74,  70,  65,  58,  50,   5,  -2,  -2,  -2,  -2,  -2,  -5],
[  -7,  -8,  -9, -10,  -9,  -7,  -6,  -7,  -9,  -5,  -3,  -2,  -2,   0,   0,   0,   0,   0,   1,   1,   3,   2,   2,   2,   2,   1,   0,   0,   0,   0,   3,   8,  15,  18,  24,  26,  27,  33,  34,  37,  38,  38,  39,  40,  41,  42,  43,  44,  45,  55,  66,  78,  75,  65,  55,  50,  25,   4,  -2,  -2,  -2,  -2,  -2,  -5],
[  -8,  -9, -10, -11, -12,  -8,  -7,  -9,  -8,  -7,  -5,  -3,  -2,  -2,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   0,   0,   0,   0,   0,   4,   9,  17,  19,  25,  27,  28,  34,  35,  38,  40,  41,  43,  45,  47,  48,  48,  49,  50,  60,  70,  80,  70,  60,  53,  40,  22,   3,  -2,  -2,  -2,  -2,  -2,  -6],
[  -9, -11, -12, -11, -13, -12, -12, -11, -13,  -9,  -7,  -5,  -3,  -2,  -2,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   5,  10,  19,  20,  26,  28,  29,  33,  36,  41,  43,  46,  49,  51,  53,  55,  56,  58,  60,  70,  84,  77,  68,  58,  45,  25,  10,  -2,  -2,  -2,  -2,  -2,  -2,  -6],
[ -11, -12, -12, -13, -13, -13, -14, -14, -14, -11,  -9,  -7,  -5,  -3,  -2,  -2,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   3,   7,  13,  21,  21,  25,  29,  30,  34,  37,  44,  50,  55,  59,  62,  63,  65,  67,  69,  75,  80,  82,  75,  65,  48,  38,  20,   5,  -2,  -2,  -2,  -2,  -2,  -4,  -7],
[ -13, -13, -14, -14, -14, -14, -15, -15, -16, -13, -11,  -9,  -7,  -5,  -3,  -2,  -2,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   5,  10,  15,  23,  22,  26,  28,  31,  35,  38,  46,  54,  63,  68,  71,  74,  78,  81,  82,  84,  88,  80,  72,  50,  40,  25,  10,  -2,  -2,  -2,  -2,  -2,  -3,  -5,  -8],
[ -14, -15, -15, -16, -16, -15, -16, -17, -17, -15, -13, -11,  -9,  -7,  -5,  -3,  -2,  -2,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   5,  10,  15,  22,  24,  26,  27,  29,  32,  36,  39,  47,  55,  64,  69,  72,  75,  79,  84,  85,  86,  87,  75,  65,  45,  35,  15,   0,   0,  -2,  -2,  -2,  -2,  -4,  -6,  -9],
[ -15, -15, -16, -16, -17, -17, -18, -18, -18, -17, -15, -13, -11,  -9,  -7,  -5,  -3,  -2,  -2,   0,   0,   0,   0,   0,   0,   0,   0,   5,  10,  18,  20,  23,  25,  27,  28,  30,  33,  37,  40,  48,  57,  65,  70,  73,  76,  80,  85,  88,  90,  85,  70,  60,  40,  22,   8,   0,   0,  -2,  -2,  -2,  -3,  -5,  -7, -10]
];

tri_sail_side = [
[ -50, -41, -32, -23, -13,  -7,   6,  15,  35,  44,  53,  61,  68,  75,  81,  87,  89,  87,  85,  86,  84,  83,  82,  81,  80,  79,  78,  77,  75,  73,  66,  58,  50, -41,  32,  23,  13,   3,   6,  16,  26,  35,  44,  53,  61,  68,  75,  81,  87,  91,  95,  97,  99, 100, 100,  99,  97,  94,  90,  85,  79,  73,  66,  29],
[ -45, -36, -27, -18,  -8,   1,  12,  21,  31,  40,  49,  57,  65,  72,  79,  84,  89,  88,  86,  86,  84,  85,  82,  79,  79,  78,  77,  76,  73,  69,  62,  54,  45,  37,  27,  18,   8,   2,  12,  21,  31,  40,  49,  57,  65,  72,  78,  84,  89,  93,  96,  98, 100, 100,  99,  98,  95,  92,  87,  82,  76,  69,  62,  27],
[ -41, -31, -22, -12,  -3,   7,  17,  27,  36,  45,  53,  61,  69,  76,  82,  90,  91,  90,  87,  87,  85,  85,  81,  77,  78,  76,  75,  74,  72,  65,  58,  49,  41,  32,  22,  12,   3,   7,  17,  26,  36,  45,  53,  61,  69,  76,  82,  87,  91,  95,  98,  99, 100, 100,  99,  96,  93,  89,  85,  79,  73,  65,  58,  25],
[ -36, -26, -17,  -7,   2,  12,  22,  32,  41,  49,  58,  65,  73,  80,  86,  91,  92,  91,  88,  88,  85,  85,  81,  76,  76,  75,  74,  73,  69,  61,  53,  45,  36,  27,  17,   7,   3,  12,  22,  31,  41,  49,  58,  65,  72,  79,  85,  89,  93,  96,  99, 100, 100,  99,  98,  95,  91,  87,  82,  76,  69,  61,  53,  23],
[ -31, -21, -12,  -2,   8,  18,  27,  36,  45,  54,  62,  69,  76,  85,  90,  92,  93,  92,  89,  88,  85,  84,  80,  75,  74,  73,  72,  71,  65,  57,  49,  40,  31,  21,  12,   2,   8,  18,  27,  36,  45,  54,  62,  69,  76,  82,  87,  92,  95,  98,  99, 100, 100,  98,  96,  93,  89,  84,  79,  72,  65,  57,  49,  12],
[ -26, -16,  -6,   1,  13,  23,  32,  41,  50,  58,  66,  73,  81,  88,  92,  94,  95,  93,  90,  90,  86,  83,  80,  74,  73,  70,  69,  68,  61,  53,  44,  35,  26,  16,   7,   3,  13,  23,  32,  41,  50,  58,  66,  73,  79,  85,  90,  94,  97,  99, 100, 100,  99,  97,  95,  91,  87,  81,  75,  68,  61,  53,  44,  18],
[ -21, -11,   0,   9,  18,  28,  37,  46,  55,  62,  75,  83,  88,  93,  94,  95,  96,  94,  92,  90,  86,  82,  79,  73,  70,  67,  65,  64,  57,  48,  39,  30,  21,  11,   1,   8,  18,  28,  37,  46,  54,  62,  70,  76,  82,  88,  92,  95,  98,  99, 100, 100,  98,  96,  93,  89,  84,  78,  72,  65,  57,  48,  40,  15],
[ -16,  -6,   4,  14,  23,  33,  42,  51,  59,  88,  92,  94,  96,  98, 100,  98,  96,  95,  93,  91,  87,  80,  79,  72,  68,  65,  63,  60,  52,  44,  35,  25,  16,   6,   4,  14,  23,  33,  42,  51,  59,  66,  73,  80,  85,  90,  94,  97,  99, 100, 100,  99,  97,  94,  91,  86,  81,  75,  68,  60,  52,  44,  35,  15],
[ -10,   0,   9,  19,  28,  38,  47,  55,  88,  89,  90,  91,  92,  94,  97, 100,  98,  96,  95,  91,  87,  80,  78,  72,  65,  63,  60,  56,  48,  39,  30,  20,  10,   1,   9,  19,  28,  38,  47,  55,  63,  70,  77,  83,  88,  92,  95,  98,  99, 100, 100,  98,  96,  93,  89,  84,  78,  71,  64,  56,  48,  39,  30,  15],
[  -5,   5,  14,  24,  33,  42,  51,  59,  90,  92,  92,  92,  94,  96,  97,  98,  99,  97,  96,  92,  88,  82,  77,  71,  64,  62,  58,  52,  43,  34,  25,  15,   5,   5,  14,  24,  33,  42,  51,  59,  67,  74,  80,  86,  90,  94,  97,  99, 100, 100,  99,  97,  94,  91,  86,  81,  74,  67,  60,  52,  43,  34,  25,  15],
[   0,  10,  20,  29,  38,  47,  56,  63,  92,  93,  94,  95,  95,  97,  98,  99, 100, 100,  98,  95,  90,  85,  80,  75,  62,  59,  55,  47,  38,  29,  20,  10,   0,  10,  20,  29,  38,  47,  55,  59,  62,  75,  80,  85,  90,  95,  98, 100, 100,  99,  98,  97,  96,  95,  94,  93,  92,  63,  56,  47,  38,  20,  10,   7],
[  -5,  15,  25,  34,  43,  52,  60,  67,  74,  81,  86,  91,  94,  97,  99, 100, 100,  99,  97,  94,  90,  86,  80,  74,  67,  59,  51,  42,  33,  24,  14,   5,   5,  15,  25,  34,  43,  52,  58,  62,  64,  71,  77,  82,  88,  92,  96,  97,  99,  98,  97,  96,  94,  92,  92,  92,  90,  59,  51,  42,  33,  24,  14,   5],
[ -10,  15,  30,  39,  48,  56,  64,  71,  78,  84,  89,  93,  96,  98, 100, 100,  99,  98,  95,  92,  88,  83,  77,  70,  63,  55,  47,  38,  28,  19,   9,   1,  10,  20,  30,  39,  48,  56,  60,  63,  65,  72,  78,  80,  87,  91,  95,  96,  98, 100,  97,  94,  92,  91,  90,  89,  88,  55,  47,  38,  28,  19,   9,   0],
[ -16,  15,  35,  44,  52,  60,  68,  75,  81,  86,  91,  94,  97,  99, 100, 100,  99,  97,  94,  90,  85,  80,  73,  66,  59,  51,  42,  33,  23,  14,   4,   6,  16,  25,  35,  44,  52,  60,  63,  65,  68,  72,  79,  80,  87,  91,  93,  95,  96,  98, 100,  98,  96,  94,  92,  88,  59,  51,  42,  33,  23,  14,   4,  -6],
[ -21,  15,  40,  48,  57,  65,  72,  78,  84,  89,  93,  96,  98, 100, 100,  99,  98,  95,  92,  88,  82,  76,  70,  62,  54,  46,  37,  28,  18,   8,   1,  11,  21,  30,  39,  48,  57,  64,  65,  67,  70,  73,  79,  82,  86,  90,  92,  94,  96,  95,  94,  93,  88,  83,  75,  62,  55,  46,  37,  28,  18,   9,   0, -11],
[ -26,  18,  44,  53,  61,  68,  75,  81,  87,  91,  95,  97,  99, 100, 100,  99,  97,  94,  90,  85,  79,  73,  66,  58,  50,  41,  32,  23,  13,   3,   7,  16,  26,  35,  44,  53,  61,  68,  69,  70,  73,  74,  80,  83,  86,  90,  90,  93,  95,  94,  92,  88,  81,  73,  66,  58,  50,  41,  32,  23,  13,   1,  -6, -16],
[ -31,  12,  49,  57,  65,  72,  79,  84,  89,  93,  96,  98, 100, 100,  99,  98,  95,  92,  87,  82,  76,  69,  62,  54,  45,  36,  27,  18,   8,   2,  12,  21,  31,  40,  49,  57,  65,  71,  72,  73,  74,  75,  80,  84,  85,  88,  89,  92,  93,  92,  90,  85,  76,  69,  62,  54,  45,  36,  27,  18,   8,  -2, -12, -21],
[ -36,  23,  53,  61,  69,  76,  82,  87,  91,  95,  98,  99, 100, 100,  99,  96,  93,  89,  85,  79,  72,  65,  58,  49,  41,  31,  22,  12,   3,   7,  17,  27,  36,  45,  53,  61,  69,  73,  74,  75,  76,  76,  81,  85,  85,  88,  88,  91,  92,  91,  86,  80,  73,  65,  58,  49,  41,  32,  22,  12,   2,  -7, -17, -26],
[ -41,  25,  58,  65,  73,  79,  85,  89,  93,  96,  99, 100, 100,  99,  98,  95,  91,  87,  82,  76,  69,  61,  53,  45,  36,  26,  17,   7,   3,  12,  22,  32,  41,  49,  58,  65,  72,  74,  75,  76,  78,  77,  81,  85,  85,  87,  87,  90,  91,  90,  82,  76,  69,  61,  53,  45,  36,  27,  17,   7,  -3, -12, -22, -31],
[ -45,  27,  62,  69,  76,  82,  87,  92,  95,  98,  99, 100, 100,  98,  96,  93,  89,  84,  78,  72,  65,  57,  49,  40,  31,  21,  12,   2,   8,  18,  27,  37,  45,  54,  62,  69,  73,  76,  77,  78,  79,  79,  82,  85,  84,  86,  86,  88,  89,  84,  79,  72,  65,  57,  49,  40,  31,  21,  12,   1,  -8, -18, -27, -36],
[ -50,  29,  66,  73,  79,  85,  90,  94,  97,  99, 100, 100,  99,  97,  95,  91,  87,  81,  75,  68,  61,  53,  44,  35,  26,  16,   6,   3,  13,  23,  32, -41,  50,  58,  66,  73,  75,  77,  78,  79,  80,  81,  82,  83,  84,  86,  85,  87,  89,  87,  81,  75,  68,  61,  53,  44,  35,  15,   6,  -7, -13, -23, -32, -41]
];

quad_sail_traverse = [
[ -15, -13, -11,  -9,  -7,  -5,  -3,  -2,  -1,  -1,   5,  15,  40,  45,  50,  60,  65,  63,  60,  56,  52,  48,  45,  42,  40,  38,  36,  34,  32,  30,  25,  23,  20,  18,  15,  12,   5,   1,   1,   1,  -1,  -2,  -3,  -4,  -5,  -6,  -7,  -8, -10, -12, -15, -18, -22, -25, -27, -30, -32, -30, -28, -26, -24, -22, -19, -17],
[ -18, -16, -14, -12, -10,  -7,  -5,  -2,  -1,  -1,   3,  10,  30,  35,  45,  55,  70,  73,  76,  80,  83,  80,  75,  70,  60,  55,  50,  45,  40,  35,  30,  27,  25,  22,  18,  15,  10,   2,   1,   1,  -1,  -1,  -3,  -4,  -5,  -6,  -7, -10, -12, -15, -18, -20, -24, -26, -28, -31, -33, -32, -30, -28, -26, -24, -21, -19],
[ -21, -19, -17, -15, -13, -10,  -7,  -4,  -2,  -1,   2,   5,  10,  25,  35,  45,  55,  65,  70,  77,  85,  90,  93,  90,  85,  75,  65,  55,  45,  40,  35,  33,  30,  25,  22,  20,  15,   3,   1,   1,   1,  -1,  -2,  -3,  -4,  -5,  -6,  -8, -10, -12, -15, -18, -20, -24, -26, -28, -30, -34, -34, -30, -28, -25, -23, -21],
[ -24, -22, -20, -18, -16, -13,  -9,  -5,  -1,  -1,  -1,   3,   5,  15,  25,  35,  45,  50,  60,  65,  75,  85,  95,  97,  95,  85,  75,  65,  55,  45,  40,  37,  35,  32,  27,  25,  20,   4,   2,   1,   1,   1,  -1,  -2,  -3,  -4,  -5,  -6,  -8, -10, -12, -15, -18, -20, -24, -26, -28, -33, -35, -32, -30, -26, -24, -23],
[ -27, -25, -23, -21, -19, -16, -11,  -7,  -3,  -2,  -1,  -1,   3,   7,  15,  25,  35,  40,  50,  55,  65,  75,  80,  90, 100,  96,  90,  85,  80,  70,  60,  50,  45,  42,  37,  35,  25,   5,   3,   2,   1,   1,  -1,  -2,  -2,  -3,  -3,  -5,  -6,  -8, -10, -12, -15, -18, -22, -24, -26, -32, -34, -36, -34, -30, -28, -27],
[ -30, -28, -26, -24, -22, -19, -13,  -9,  -5,  -2,  -1,  -1,  -1,   3,   9,  15,  25,  30,  40,  45,  55,  65,  70,  77,  85,  98,  90,  86,  83,  74,  65,  55,  50,  47,  43,  40,  30,  10,   5,   3,   1,   1,   1,  -1,  -2,  -2,  -3,  -4,  -5,  -6,  -8, -10, -12, -16, -21, -23, -25, -31, -34, -35, -37, -35, -32, -30],
[ -33, -31, -29, -27, -25, -22, -15, -11,  -8,  -3,  -2,  -1,  -1,  -1,   3,   7,  10,  20,  30,  35,  45,  55,  60,  67,  75,  85,  92,  87,  84,  76,  65,  60,  55,  52,  48,  45,  40,  20,  15,   5,   3,   1,   1,   1,  -1,  -1,  -2,  -3,  -4,  -5,  -7,  -8, -10, -15, -20, -22, -25, -30, -33, -35, -36, -37, -35, -33],
[ -36, -34, -32, -30, -28, -25, -17, -13, -11,  -6,  -4,  -2,  -1,  -1,  -1,   3,   7,  10,  20,  25,  35,  45,  50,  57,  65,  75,  79,  80,  85,  78,  70,  63,  60,  57,  53,  50,  45,  30,  25,  15,   5,   3,   1,   1,   1,  -1,  -2,  -2,  -3,  -4,  -5,  -6,  -8, -12, -18, -20, -24, -28, -32, -34, -36, -38, -39, -36],
[ -39, -37, -35, -33, -31, -28, -19, -17, -14,  -9,  -7,  -3,  -2,  -1,  -1,  -1,   3,   7,  10,  15,  25,  35,  40,  47,  55,  65,  69,  70,  75,  80,  73,  65,  64,  61,  58,  55,  50,  40,  35,  25,  15,  10,   3,   1,   0,   0,  -1,  -1,  -2,  -3,  -4,  -5,  -7,  -9, -16, -19, -23, -26, -30, -34, -35, -38, -39, -39],
[ -42, -40, -38, -36, -34, -31, -21, -20, -17, -12, -10,  -5,  -3,  -2,  -1,  -1,  -1,   3,   7,  10,  15,  25,  35,  40,  45,  55,  59,  60,  65,  70,  75,  70,  67,  65,  62,  58,  55,  50,  45,  35,  25,  15,  10,   3,   1,   0,   0,   0,  -1,  -2,  -3,  -4,  -5,  -7, -13, -16, -22, -25, -27, -33, -36, -39, -40, -41],
[ -45, -43, -40, -38, -35, -32, -25, -23, -20, -15, -12,  -6,  -5,  -3,  -2,  -1,   0,   0,   3,   5,   7,  10,  20,  30,  35,  40,  50,  53,  57,  62,  65,  68,  70,  68,  65,  62,  57,  53,  50,  40,  35,  30,  20,  10,   7,   5,   3,   0,   0,  -1,  -2,  -3,  -5,  -6, -12, -15, -20, -23, -27, -34, -36, -40, -41, -43],
[ -42, -41, -40, -39, -36, -33, -27, -25, -22, -16, -13,  -7,  -5,  -4,  -3,  -2,  -1,   0,   0,   0,   1,   3,  10,  15,  25,  35,  45,  50,  55,  58,  62,  65,  67,  70,  75,  70,  65,  60,  59,  55,  45,  40,  35,  25,  15,  10,   7,   3,  -1,  -1,  -1,  -2,  -3,  -5, -10, -12, -17, -20, -21, -31, -34, -36, -38, -40],
[ -39, -39, -39, -38, -35, -34, -30, -26, -23, -19, -16,  -9,  -7,  -5,  -4,  -3,  -2,  -1,  -1,   0,   0,   1,   3,  10,  15,  25,  35,  40,  50,  55,  58,  61,  64,  65,  73,  80,  75,  70,  69,  65,  55,  47,  40,  35,  25,  15,  10,   7,   3,  -1,  -1,  -1,  -2,  -3,  -7,  -9, -14, -17, -19, -28, -31, -33, -35, -37],
[ -36, -36, -39, -38, -36, -34, -32, -28, -24, -20, -18, -12,  -8,  -6,  -5,  -4,  -3,  -2,  -2,  -1,   1,   1,   1,   3,   5,  15,  25,  30,  45,  50,  53,  57,  60,  63,  70,  78,  85,  80,  79,  75,  65,  57,  50,  45,  35,  25,  20,  10,   7,   3,  -1,  -1,  -1,  -2,  -4,  -6, -11, -13, -17, -25, -28, -30, -32, -34],
[ -33, -33, -35, -37, -36, -35, -33, -30, -25, -22, -20, -15, -10,  -8,  -7,  -5,  -4,  -3,  -2,  -1,  -1,   1,   1,   1,   3,   5,  15,  20,  40,  45,  48,  52,  55,  60,  65,  76,  84,  87,  92,  85,  75,  67,  60,  55,  45,  35,  30,  20,  10,   7,   3,  -1,  -1,  -1,  -2,  -3,  -8, -11, -15, -22, -25, -27, -29, -31],
[ -30, -30, -32, -35, -37, -35, -34, -31, -25, -23, -21, -16, -12, -10,  -8,  -6,  -5,  -4,  -3,  -2,  -2,  -1,   1,   1,   1,   3,   5,  10,  30,  40,  43,  47,  50,  55,  65,  74,  83,  86,  90,  98,  85,  77,  70,  65,  55,  45,  40,  30,  25,  15,   9,   3,  -1,  -1,  -1,  -2,  -5,  -9, -13, -19, -22, -24, -26, -28],
[ -27, -27, -28, -30, -34, -36, -34, -32, -26, -24, -22, -18, -15, -12, -10,  -8,  -6,  -5,  -3,  -3,  -2,  -2,  -1,   1,   1,   2,   3,   5,  25,  35,  37,  42,  45,  50,  60,  70,  80,  85,  90,  96, 100,  90,  80,  75,  65,  55,  50,  40,  35,  25,  15,   7,   3,  -1,  -1,  -2,  -3,  -7, -11, -16, -19, -21, -23, -25],
[ -24, -23, -24, -26, -30, -32, -35, -33, -28, -26, -24, -20, -18, -15, -12, -10,  -8,  -6,  -5,  -4,  -3,  -2,  -1,   1,   1,   1,   2,   4,  20,  25,  27,  32,  35,  37,  40,  45,  55,  65,  75,  85,  95,  97,  95,  85,  75,  65,  60,  50,  45,  35,  25,  15,   5,   3,  -1,  -1,  -1,  -5,  -9, -13, -16, -18, -20, -22],
[ -21, -21, -23, -25, -28, -30, -34, -34, -30, -28, -26, -24, -20, -18, -15, -12, -10,  -8,  -6,  -5,  -4,  -3,  -2,  -1,   1,   1,   1,   3,  15,  20,  22,  25,  30,  33,  35,  40,  45,  55,  65,  75,  85,  90,  93,  90,  85,  77,  70,  65,  55,  45,  35,  25,  10,   5,   2,  -1,  -2,  -4,  -7, -10, -13, -15, -17, -19],
[ -18, -19, -21, -24, -26, -28, -30, -32, -33, -31, -28, -26, -24, -20, -18, -15, -12, -10,  -7,  -6,  -5,  -4,  -3,  -1,  -1,   1,   1,   2,  10,  15,  18,  22,  25,  27,  30,  35,  40,  45,  50,  55,  60,  70,  75,  80,  83,  80,  76,  73,  70,  55,  45,  35,  30,  10,   3,  -1,  -1,  -2,  -5,  -7, -10, -12, -14, -16],
[ -15, -17, -19, -22, -24, -26, -28, -30, -32, -30, -27, -25, -22, -18, -15, -12, -10,  -8,  -7,  -6,  -5,  -4,  -3,  -2,  -1,   1,   1,   1,   5,  12,  15,  18,  20,  23,  25,  30,  32,  34,  36,  38,  40,  42,  45,  48,  52,  56,  60,  63,  65,  60,  50,  45,  40,  15,   5,  -1,  -1,  -2,  -3,  -5,  -7,  -9, -11, -13]
];

quad_sail_side = [
[  50,  41,  32,  23,  13,   3,   7,  16,  26,  35,  44,  56,  68,  80,  93,  99,  92,  91,  89,  88,  88,  87,  87,  86,  86,  85,  84,  82,  79,  73,  66,  58,  50,  41,  32,  23,  13,   3,   7,  16,  26,  35,  44,  56,  68,  80,  93,  99,  92,  91,  89,  88,  88,  87,  87,  86,  86,  85,  84,  82,  79,  73,  66,  58],
[  48,  37,  30,  23,  15,   6,   4,   6,  16,  25,  35,  44,  52,  70,  83,  89,  85,  83,  81,  82,  84,  85,  86,  88,  87,  85,  83,  80,  74,  67,  60,  53,  48,  37,  30,  23,  15,   6,   4,   6,  16,  25,  35,  44,  52,  70,  83,  89,  85,  83,  81,  82,  84,  85,  86,  88,  87,  85,  83,  80,  74,  67,  60,  53],
[  45,  34,  28,  22,  17,   9,  10,   4,   6,  16,  25,  35,  44,  55,  65,  72,  75,  77,  79,  81,  82,  84,  85,  89,  88,  85,  82,  76,  68,  61,  54,  48,  45,  34,  28,  22,  17,   9,  10,   4,   6,  16,  25,  35,  44,  55,  65,  72,  75,  77,  79,  81,  82,  84,  85,  89,  88,  85,  82,  76,  68,  61,  54,  48],
[  40,  31,  26,  22,  19,  12,  15,   9,   5,   5,  14,  24,  33,  47,  51,  59,  67,  70,  74,  76,  81,  85,  88,  89,  91,  85,  78,  71,  62,  55,  48,  43,  40,  31,  26,  22,  19,  12,  15,   9,   5,   5,  14,  24,  33,  47,  51,  59,  67,  70,  74,  76,  81,  85,  88,  89,  91,  85,  78,  71,  62,  55,  48,  43],
[  35,  28,  24,  22,  21,  16,  20,  14,  16,   6,   4,  14,  23,  38,  42,  51,  59,  59,  66,  69,  75,  80,  83,  85,  88,  81,  74,  66,  58,  49,  42,  38,  35,  28,  24,  22,  21,  16,  20,  14,  16,   6,   4,  14,  23,  38,  42,  51,  59,  59,  66,  69,  75,  80,  83,  85,  88,  81,  74,  66,  58,  49,  42,  38],
[  30,  25,  22,  21,  23,  20,  25,  20,  26,  16,   6,   3,  13,  23,  32,  41,  50,  51,  58,  62,  69,  75,  78,  81,  85,  77,  70,  61,  54,  43,  36,  33,  30,  25,  22,  21,  23,  20,  25,  20,  26,  16,   6,   3,  13,  23,  32,  41,  50,  51,  58,  62,  69,  75,  78,  81,  85,  77,  70,  61,  54,  43,  36,  33],
[  25,  22,  20,  21,  25,  24,  30,  28,  36,  26,  17,   7,   3,  17,  22,  32,  41,  43,  50,  55,  63,  70,  73,  77,  82,  73,  66,  57,  48,  37,  30,  28,  25,  22,  20,  21,  25,  24,  30,  28,  36,  26,  17,   7,   3,  17,  22,  32,  41,  43,  50,  55,  63,  70,  73,  77,  82,  73,  66,  57,  48,  37,  30,  28],
[  20,  19,  18,  20,  27,  28,  35,  36,  45,  36,  27,  18,   8,  12,  12,  21,  31,  35,  43,  48,  57,  65,  69,  73,  79,  70,  62,  53,  44,  31,  24,  23,  20,  19,  18,  20,  27,  28,  35,  36,  45,  36,  27,  18,   8,  12,  12,  21,  31,  35,  43,  48,  57,  65,  69,  73,  79,  70,  62,  53,  44,  31,  24,  23],
[  15,  16,  17,  20,  28,  32,  40,  44,  54,  46,  37,  28,  18,   2,   1,  11,  21,  27,  36,  41,  51,  60,  65,  70,  76,  67,  58,  48,  38,  26,  20,  18,  15,  16,  17,  20,  28,  32,  40,  44,  54,  46,  37,  28,  18,   2,   1,  11,  21,  27,  36,  41,  51,  60,  65,  70,  76,  67,  58,  48,  38,  26,  20,  18],
[  10,  13,  16,  20,  29,  36,  45,  52,  63,  55,  47,  38,  28,  19,   9,   1,  10,  19,  29,  34,  45,  55,  61,  67,  73,  64,  54,  44,  34,  23,  17,  13,  10,  13,  16,  20,  29,  36,  45,  52,  63,  55,  47,  38,  28,  19,   9,   1,  10,  19,  29,  34,  45,  55,  61,  67,  73,  64,  54,  44,  34,  23,  17,  13],
[   5,  10,  15,  20,  30,  40,  50,  60,  71,  63,  56,  47,  38,  29,  20,  10,   0,  10,  20,  29,  38,  47,  56,  63,  71,  60,  50,  40,  30,  20,  15,  10,   5,  10,  15,  20,  30,  40,  50,  60,  71,  63,  56,  47,  38,  29,  20,  10,   0,  10,  20,  29,  38,  47,  56,  63,  71,  60,  50,  40,  30,  20,  15,  10],
[  10,  13,  17,  23,  34,  44,  54,  64,  73,  67,  61,  55,  45,  34,  29,  19,   7,   1,   9,  19,  28,  38,  47,  55,  63,  52,  45,  36,  29,  20,  16,  13,  10,  13,  17,  23,  34,  44,  54,  64,  73,  67,  61,  55,  45,  34,  29,  19,  10,   1,   9,  19,  28,  38,  47,  55,  63,  52,  45,  36,  29,  20,  16,  13],
[  15,  18,  20,  26,  38,  48,  58,  67,  76,  70,  65,  60,  51,  41,  36,  27,  16,  11,   1,   2,  18,  28,  37,  46,  54,  44,  40,  32,  28,  20,  17,  16,  15,  18,  20,  26,  38,  48,  58,  67,  76,  70,  65,  60,  51,  41,  36,  27,  21,  11,   1,   2,  18,  28,  37,  46,  54,  44,  40,  32,  28,  20,  17,  16],
[  20,  23,  24,  31,  44,  53,  62,  70,  79,  73,  69,  65,  57,  48,  43,  35,  25,  21,  12,  12,   8,  18,  27,  36,  45,  36,  35,  28,  27,  20,  18,  19,  20,  23,  24,  31,  44,  53,  62,  70,  79,  73,  69,  65,  57,  48,  43,  35,  31,  21,  12,  12,   8,  18,  27,  36,  45,  36,  35,  28,  27,  20,  18,  19],
[  25,  28,  30,  37,  48,  57,  66,  73,  82,  77,  73,  70,  63,  55,  50,  43,  34,  32,  22,   3,   3,   7,  17,  26,  36,  28,  30,  24,  25,  21,  20,  22,  25,  28,  30,  37,  48,  57,  66,  73,  82,  77,  73,  70,  63,  55,  50,  43,  41,  32,  22,  17,   3,   7,  17,  26,  36,  28,  30,  24,  25,  21,  20,  22],
[  30,  33,  36,  43,  54,  61,  70,  77,  85,  81,  78,  75,  69,  62,  58,  51,  43,  41,  32,  23,  13,   3,   6,  16,  26,  20,  25,  20,  23,  21,  22,  25,  30,  33,  36,  43,  54,  61,  70,  77,  85,  81,  78,  75,  69,  62,  58,  51,  50,  41,  32,  23,  13,   3,   6,  16,  26,  20,  25,  20,  23,  21,  22,  25],
[  35,  38,  42,  49,  58,  66,  74,  81,  88,  85,  83,  80,  75,  69,  66,  59,  52,  51,  42,  42,  23,  14,   4,   6,  16,  14,  20,  16,  21,  22,  24,  28,  35,  38,  42,  49,  58,  66,  74,  81,  88,  85,  83,  80,  75,  69,  66,  59,  59,  51,  42,  38,  23,  14,   4,   6,  16,  14,  20,  16,  21,  22,  24,  28],
[  40,  43,  48,  55,  62,  71,  78,  85,  91,  89,  88,  85,  81,  76,  74,  67,  61,  59,  51,  52,  33,  24,  14,   5,   5,   9,  15,  12,  19,  22,  26,  31,  40,  43,  48,  55,  62,  71,  78,  85,  91,  89,  88,  85,  81,  76,  74,  70,  67,  59,  51,  47,  33,  24,  14,   5,   5,   9,  15,  12,  19,  22,  26,  31],
[  45,  48,  54,  61,  68,  76,  82,  88,  93,  93,  92,  90,  87,  83,  81,  75,  70,  68,  60,  60,  44,  35,  25,  16,   6,   4,  10,   9,  17,  22,  28,  34,  45,  48,  54,  61,  68,  76,  82,  85,  88,  89,  85,  84,  82,  81,  79,  77,  75,  72,  65,  55,  44,  35,  25,  16,   6,   4,  10,   9,  17,  22,  28,  34],
[  48,  53,  60,  67,  74,  81,  86,  91,  95,  96,  96,  95,  93,  90,  88,  83,  79,  75,  68,  68,  52,  44,  35,  25,  16,   6,   4,   6,  15,  23,  30,  37,  48,  53,  60,  67,  74,  80,  83,  85,  87,  88,  86,  85,  84,  82,  81,  83,  85,  89,  83,  70,  52,  44,  35,  25,  16,   6,   4,   6,  15,  23,  30,  37],
[  50,  58,  66,  73,  79,  85,  90,  94,  97,  99, 100, 100,  99,  97,  95,  91,  87,  81,  75,  68,  61,  53,  44,  35,  26,  16,   7,   3,  13,  23,  32,  41,  50,  58,  66,  73,  79,  82,  84,  85,  86,  86,  87,  87,  88,  88,  89,  91,  92,  99,  93,  80,  68,  56,  44,  35,  26,  16,   7,   3,  13,  23,  32,  41]
];


_findmax = {
	private _max = -1e10;
	private _maxindex = -1;
	{
		if(_x>_max)then{
			_max = _x;
			_maxindex = _foreachindex;
		};
	}foreach _this;
	_maxindex;
};

jib_sail_traverse = [];
{
	private _a = tri_sail_traverse apply {_x#_foreachindex};
	private _maxIndex = _a call _findmax;
	jib_sail_traverse pushback (_a#_maxindex);
}foreach (tri_sail_traverse#0);

jib_sail_side =
[  20,  25,  30,  35,  38,  47,  56,  63,  88,  88,  92,  94,  88,  88,  90,  90,  89,  87,  85,  86,  84,  83,  82,  81,  80,  79,  78,  77,  75,  73,  66,  58,  50,  58,  66,  73,  75,  77,  78,  79,  80,  81,  82,  83,  84,  86,  85,  87,  89,  90,  90,  88,  88,  94,  92,  88,  88,  63,  56,  47,  38,  35,  30,  25];

sail_steps = [0.1,5.625];
